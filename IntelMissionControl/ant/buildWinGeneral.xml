<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="buildWinGeneral" name="Create Runnable Jar for Project OpenMissionControl Win-Base" basedir="../">


	
	<property name="sys" value="Win"/>

	<import file="paths.xml" />

	
	<property name="py.agisoft.1.0" value="${path.imc}/resources/eu/mavinci/agisoft/IntelLib_1-0.py" />
	<property name="py.agisoft.1.1" value="${path.imc}/resources/eu/mavinci/agisoft/IntelLib_1-1.py" />
	<property name="py.agisoft.1.2" value="${path.imc}/resources/eu/mavinci/agisoft/IntelLib_1-2.py" />
	<property name="py.agisoft.1.3" value="${path.imc}/resources/eu/mavinci/agisoft/IntelLib_1-3.py" />
	<property name="py.agisoft.1.4" value="${path.imc}/resources/eu/mavinci/agisoft/IntelLib_1-4.py" />
	<property name="py.agisoft.1.5" value="${path.imc}/resources/eu/mavinci/agisoft/IntelLib_1-5.py" />

	<target name="obfuscate" unless="debugOn">
		<pyObfuscate file="${py.agisoft.1.0}"/>
		<pyObfuscate file="${py.agisoft.1.1}"/>
		<pyObfuscate file="${py.agisoft.1.2}"/>
		<pyObfuscate file="${py.agisoft.1.3}"/>
		<pyObfuscate file="${py.agisoft.1.4}"/>
		<pyObfuscate file="${py.agisoft.1.5}"/>
		<taskdef resource="proguard/ant/task.properties"
	         classpath="/opt/proguard6/lib/proguard.jar" />
		<proguard configuration="ant/proguard_imc.cfg"/>
	</target>
	
	<target name="nonobfuscate" if="debugOn">
		<copy file="${path.imc}/target/OpenMissionControl-1.0.jar" tofile="${path.imc}/setupFiles/OpenMissionControl.jar" overwrite="true"/>
	</target>
	
	
	<target name="createJRE" description="Create local JRE">
		
		<property name="jreVersion" value="10.0.1"/>

		
		<delete dir="jre"/>
		<mkdir dir="jre"/>
		<mkdir dir="jre/32"/>
		<mkdir dir="jre/64"/>
		<!--<mkdir dir="jre/common"/>-->
		<delete>
		    <fileset dir="lib32" includes="jre*.tar"/>
			<fileset dir="lib64" includes="jre*.tar"/>
		</delete>
		
		<!--<gunzip src="/home/compiler/guiAux/jre-${jreVersion}-windows-i586.tar.gz" dest="lib32"/>
		<untar src="lib32/jre-${jreVersion}-windows-i586.tar" dest="jre/32"/>
		<move todir="jre/32">
		    <fileset dir="jre/32/jre${jreVersionLong}"/>
		</move>-->
		
		<gunzip src="/home/compiler/guiAux/jre-${jreVersion}_windows-x64_bin.tar.gz" dest="lib64"/>
		<untar src="lib64/jre-${jreVersion}_windows-x64_bin.tar" dest="jre/64"/>
		<move todir="jre/64">
		    <fileset dir="jre/64/jre-${jreVersion}"/>
		</move>
		
		
		<!--<exec executable="${path.win}/ant/stripJRE.php" />-->
		
	</target>

	
	<target name="wrapper" depends="obfuscate,nonobfuscate" >
			<!-- <property name="launch4j.dir" location="C:\Programme\Launch4j" /> -->
			

			<property name="win_version" value="${release_version}.0.${svn_revision}"/>
			
			<property name="launch4j.dir" location="/opt/launch4j" />
			<taskdef name="launch4j"
		    classname="net.sf.launch4j.ant.Launch4jTask"
		    classpath="${launch4j.dir}/launch4j.jar
		        :${launch4j.dir}/lib/xstream.jar" />
			<!-- launch4j configuration file is being found, but has a some sort of name problem inside of launch4j -->
			<!-- also this path should be relative to the configure file, but the script isn't working with it at the moment -->
			<!-- TODO change to relative path -->
			<!-- the next line doesn't work, but it should be the relative path to call launch4j with the correct config.xml file -->
			<!-- launch4j configFile=" ..\configure.xml" / -->
			
			<dirname property="pwd" file="."/>
					<echo>PWD=${pwd}</echo>
			
			<launch4j fileVersion="1.0.1.1"
						txtFileVersion="${version}"
						productVersion="1.0.1.1"
						txtProductVersion="${version}"
						configFile="../OpenMissionControl/ant/configure64.xml" />

			<property name="absolute.path" location="wrapper/OpenMissionControl.exe"/>
			
		</target>
	
	
	<target name="buildWinGeneral" depends="wrapper,createJRE" />
	
</project>
